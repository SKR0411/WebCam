<!DOCTYPE html>
<html>
<body>

<h2>Camera Stream â†’ Python Server</h2>
<video id="cam" autoplay playsinline></video>

<script>
(async () => {

  // Camera access
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  const video = document.getElementById("cam");
  video.srcObject = stream;

  // Connect WebSocket to Python server
  const ws = new WebSocket(`ws://${location.hostname}:8001`);

  ws.onopen = () => console.log("Connected to Python server");

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  // Send frames every 200ms
  setInterval(() => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0);
    const dataURL = canvas.toDataURL("image/jpeg", 0.6);

    ws.send(dataURL);
  }, 200);

})();
</script>

</body>
</html>